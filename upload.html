<!DOCTYPE html>
<html lang="en" id="html-root">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Upload Video - Vidora</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="upload-styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
  <!-- Top Header Bar -->
  <header class="top-header">
    <button class="hamburger" id="hamburger">
      <i class="fas fa-bars"></i>
    </button>

    <a href="index.html" class="logo">Vidora</a>

    <div class="search-container">
      <input type="text" placeholder="Search videos..." class="search-input" />
      <button class="search-btn">
        <i class="fas fa-search"></i>
      </button>
    </div>

    <div class="header-right">
      <a href="upload.html" class="btn btn-create">
        <i class="fas fa-plus"></i>
        <span>Create</span>
      </a>

      <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
        <i class="fas fa-moon"></i>
      </button>

      <div class="user-menu">
        <button class="user-avatar" id="user-avatar">
          <i class="fas fa-user"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- Desktop Sidebar Navigation -->
  <nav class="desktop-sidebar" id="desktop-sidebar">
    <div class="sidebar-content">
      <!-- Main Navigation -->
      <div class="nav-section">
        <a href="index.html" class="nav-item">
          <i class="fas fa-home"></i>
          <span class="nav-text">Home</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-fire"></i>
          <span class="nav-text">Trending</span>
        </a>
        <a href="subscriptions.html" class="nav-item">
          <i class="fas fa-play-circle"></i>
          <span class="nav-text">Subscriptions</span>
        </a>
      </div>

      <!-- Library Section -->
      <div class="nav-section">
        <div class="section-label">LIBRARY</div>
        <a href="watch-history.html" class="nav-item">
          <i class="fas fa-history"></i>
          <span class="nav-text">History</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-clock"></i>
          <span class="nav-text">Watch Later</span>
        </a>
        <a href="liked-videos.html" class="nav-item">
          <i class="fas fa-thumbs-up"></i>
          <span class="nav-text">Liked Videos</span>
        </a>
      </div>

      <!-- Subscriptions Section -->
      <div class="nav-section">
        <div class="section-label">SUBSCRIPTIONS</div>
        <div id="sidebar-subscriptions">
          <!-- Subscribed channels will appear here -->
        </div>
      </div>

      <!-- Explore Section -->
      <div class="nav-section">
        <div class="section-label">EXPLORE</div>
        <a href="#" class="nav-item">
          <i class="fas fa-music"></i>
          <span class="nav-text">Music</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-basketball-ball"></i>
          <span class="nav-text">Sports</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-gamepad"></i>
          <span class="nav-text">Gaming</span>
        </a>
      </div>
    </div>

    <!-- Collapse/Expand Toggle -->
    <button class="sidebar-toggle" id="sidebar-toggle">
      <i class="fas fa-chevron-left"></i>
    </button>
  </nav>

  <!-- Mobile Sidebar Navigation Drawer -->
  <div class="mobile-sidebar" id="mobile-sidebar">
    <div class="sidebar-header">
      <button class="close-btn" id="close-sidebar">
        <i class="fas fa-times"></i>
      </button>
      <a href="index.html" class="logo">Vidora</a>
    </div>
    <ul class="sidebar-nav">
      <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
      <li><a href="#"><i class="fas fa-fire"></i> Trending</a></li>
      <li><a href="subscriptions.html"><i class="fas fa-play-circle"></i> Subscriptions</a></li>
      <li><a href="watch-history.html"><i class="fas fa-history"></i> History</a></li>
      <li><a href="#"><i class="fas fa-clock"></i> Watch Later</a></li>
      <li><a href="liked-videos.html"><i class="fas fa-thumbs-up"></i> Liked Videos</a></li>
      <li><a href="upload.html" class="active"><i class="fas fa-upload"></i> Upload Video</a></li>
    </ul>
  </div>

  <!-- Overlay for closing mobile sidebar -->
  <div class="overlay" id="overlay"></div>

  <!-- Main Upload Content -->
  <main class="upload-container">
    <div class="upload-header">
      <h1>Upload Video</h1>
      <p>Share your content with the world</p>
    </div>

    <div class="upload-content">
      <!-- Left Side - Video Upload Area -->
      <div class="upload-left">
        <div class="upload-box" id="upload-box">
          <div class="upload-placeholder">
            <i class="fas fa-cloud-upload-alt"></i>
            <h3>Select files to upload</h3>
            <p>Or drag and drop video files</p>
            <button class="btn btn-primary" id="select-files-btn">Select Files</button>
            <input type="file" id="video-file" accept="video/*" hidden />
          </div>
          <div class="upload-progress" id="upload-progress" style="display: none;">
            <div class="progress-bar">
              <div class="progress-fill" id="progress-fill"></div>
            </div>
            <p>Uploading... <span id="progress-text">0%</span></p>
          </div>
        </div>

        <div class="video-preview" id="video-preview" style="display: none;">
          <video controls id="preview-video"></video>
          <div class="video-info">
            <h4 id="video-filename">video.mp4</h4>
            <p id="video-size">0 MB</p>
          </div>
        </div>
      </div>

      <!-- Right Side - Video Details Form -->
      <div class="upload-right">
        <form id="video-details-form">
          <div class="form-group">
            <label for="video-title">Title (required)</label>
            <input type="text" id="video-title" placeholder="Enter video title" required maxlength="100" />
            <div class="char-count"><span id="title-chars">0</span>/100</div>
          </div>

          <div class="form-group">
            <label for="video-description">Description</label>
            <textarea id="video-description" placeholder="Tell viewers about your video" rows="4" maxlength="5000"></textarea>
            <div class="char-count"><span id="description-chars">0</span>/5000</div>
          </div>

          <div class="form-group">
            <label for="video-thumbnail">Thumbnail</label>
            <div class="thumbnail-upload">
              <div class="thumbnail-preview" id="thumbnail-preview">
                <i class="fas fa-image"></i>
                <p>No thumbnail selected</p>
              </div>
              <button type="button" class="btn btn-outline" id="thumbnail-btn">Select Thumbnail</button>
              <input type="file" id="video-thumbnail" accept="image/*" hidden />
            </div>
          </div>

          <div class="form-group">
            <label for="video-category">Category</label>
            <select id="video-category">
              <option value="">Select a category</option>
              <option value="entertainment">Entertainment</option>
              <option value="education">Education</option>
              <option value="gaming">Gaming</option>
              <option value="music">Music</option>
              <option value="sports">Sports</option>
              <option value="news">News & Politics</option>
              <option value="tech">Science & Technology</option>
              <option value="lifestyle">Lifestyle</option>
            </select>
          </div>

          <div class="form-group">
            <label for="video-tags">Tags</label>
            <input type="text" id="video-tags" placeholder="Add tags (separated by commas)" />
            <div class="tags-hint">Add relevant tags to help viewers find your video</div>
          </div>

          <div class="form-group">
            <label for="video-privacy">Privacy</label>
            <select id="video-privacy">
              <option value="public">Public</option>
              <option value="unlisted">Unlisted</option>
              <option value="private">Private</option>
            </select>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-outline" id="save-draft-btn">Save Draft</button>
            <button type="submit" class="btn btn-primary" id="publish-btn" disabled>Publish</button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <script>
    // ===== THEME TOGGLE =====
    const themeToggle = document.getElementById('theme-toggle');
    const htmlRoot = document.getElementById('html-root');

    // Check saved theme or OS preference
    const savedTheme = localStorage.getItem('vidora-theme');
    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

    if (savedTheme === 'dark' || (!savedTheme && systemPrefersDark)) {
      htmlRoot.setAttribute('data-theme', 'dark');
      themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
    } else {
      htmlRoot.setAttribute('data-theme', 'light');
      themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
    }

    themeToggle.addEventListener('click', () => {
      const currentTheme = htmlRoot.getAttribute('data-theme');
      if (currentTheme === 'dark') {
        htmlRoot.setAttribute('data-theme', 'light');
        themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        localStorage.setItem('vidora-theme', 'light');
      } else {
        htmlRoot.setAttribute('data-theme', 'dark');
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        localStorage.setItem('vidora-theme', 'dark');
      }
    });

    // ===== SIDEBAR TOGGLE =====
    const hamburger = document.getElementById('hamburger');
    const mobileSidebar = document.getElementById('mobile-sidebar');
    const closeBtn = document.getElementById('close-sidebar');
    const overlay = document.getElementById('overlay');

    function openMobileSidebar() {
      mobileSidebar.classList.add('active');
      overlay.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeMobileSidebar() {
      mobileSidebar.classList.remove('active');
      overlay.classList.remove('active');
      document.body.style.overflow = '';
    }

    hamburger.addEventListener('click', openMobileSidebar);
    closeBtn.addEventListener('click', closeMobileSidebar);
    overlay.addEventListener('click', closeMobileSidebar);

    // Close mobile sidebar on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && mobileSidebar.classList.contains('active')) {
        closeMobileSidebar();
      }
    });

    // ===== DESKTOP SIDEBAR EXPAND/COLLAPSE =====
    const desktopSidebar = document.getElementById('desktop-sidebar');
    const sidebarToggle = document.getElementById('sidebar-toggle');

    // Check saved sidebar state
    const savedSidebarState = localStorage.getItem('vidora-sidebar-expanded');

    if (savedSidebarState === 'true') {
      desktopSidebar.classList.add('expanded');
      document.body.classList.add('sidebar-expanded');
    } else {
      desktopSidebar.classList.remove('expanded');
      document.body.classList.remove('sidebar-expanded');
    }

    sidebarToggle.addEventListener('click', () => {
      const isExpanded = desktopSidebar.classList.contains('expanded');
      
      if (isExpanded) {
        desktopSidebar.classList.remove('expanded');
        document.body.classList.remove('sidebar-expanded');
        localStorage.setItem('vidora-sidebar-expanded', 'false');
      } else {
        desktopSidebar.classList.add('expanded');
        document.body.classList.add('sidebar-expanded');
        localStorage.setItem('vidora-sidebar-expanded', 'true');
      }
    });

    // ===== AUTHENTICATION CHECK =====
    document.addEventListener('DOMContentLoaded', function() {
      const isAuthenticated = localStorage.getItem('userAuthenticated');
      
      if (!isAuthenticated || isAuthenticated !== 'true') {
        window.location.href = 'signin.html?redirect=upload';
        return;
      }
      
      // Display user info
      const userEmail = localStorage.getItem('userEmail');
      const userAvatar = document.getElementById('user-avatar');
      if (userEmail && userAvatar) {
        const firstLetter = userEmail.charAt(0).toUpperCase();
        userAvatar.innerHTML = `<span>${firstLetter}</span>`;
      }

      // Load subscriptions for sidebar
      const savedSubscriptions = localStorage.getItem('vidora-subscriptions');
      const sidebarSubscriptions = document.getElementById('sidebar-subscriptions');
      
      if (!savedSubscriptions || JSON.parse(savedSubscriptions).length === 0) {
        sidebarSubscriptions.innerHTML = `
          <div class="empty-sidebar-subscriptions">
            <i class="fas fa-users" style="font-size: 1.5rem; margin-bottom: 0.5rem; display: block;"></i>
            <p>No subscriptions yet</p>
          </div>
        `;
      }
    });

    // ===== UPLOAD FUNCTIONALITY =====
    const uploadBox = document.getElementById('upload-box');
    const videoFileInput = document.getElementById('video-file');
    const selectFilesBtn = document.getElementById('select-files-btn');
    const uploadProgress = document.getElementById('upload-progress');
    const progressFill = document.getElementById('progress-fill');
    const progressText = document.getElementById('progress-text');
    const videoPreview = document.getElementById('video-preview');
    const previewVideo = document.getElementById('preview-video');
    const videoFilename = document.getElementById('video-filename');
    const videoSize = document.getElementById('video-size');
    const publishBtn = document.getElementById('publish-btn');

    // Character counters
    const titleInput = document.getElementById('video-title');
    const descriptionInput = document.getElementById('video-description');
    const titleChars = document.getElementById('title-chars');
    const descriptionChars = document.getElementById('description-chars');

    titleInput.addEventListener('input', function() {
      titleChars.textContent = this.value.length;
      validateForm();
    });

    descriptionInput.addEventListener('input', function() {
      descriptionChars.textContent = this.value.length;
    });

    // File selection
    selectFilesBtn.addEventListener('click', () => {
      videoFileInput.click();
    });

    videoFileInput.addEventListener('change', handleFileSelect);

    // Drag and drop functionality
    uploadBox.addEventListener('dragover', function(e) {
      e.preventDefault();
      this.classList.add('dragover');
    });

    uploadBox.addEventListener('dragleave', function(e) {
      e.preventDefault();
      this.classList.remove('dragover');
    });

    uploadBox.addEventListener('drop', function(e) {
      e.preventDefault();
      this.classList.remove('dragover');
      
      const files = e.dataTransfer.files;
      if (files.length > 0 && files[0].type.startsWith('video/')) {
        handleFile(files[0]);
      } else {
        alert('Please select a video file.');
      }
    });

    uploadBox.addEventListener('click', () => {
      videoFileInput.click();
    });

    function handleFileSelect(e) {
      const file = e.target.files[0];
      if (file && file.type.startsWith('video/')) {
        handleFile(file);
      } else {
        alert('Please select a valid video file.');
      }
    }

    function handleFile(file) {
      // Show video preview
      const videoURL = URL.createObjectURL(file);
      previewVideo.src = videoURL;
      videoFilename.textContent = file.name;
      videoSize.textContent = formatFileSize(file.size);
      
      // Show preview and hide upload box
      uploadBox.style.display = 'none';
      videoPreview.style.display = 'block';
      
      // Enable publish button when title is filled
      validateForm();
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // Thumbnail upload
    const thumbnailBtn = document.getElementById('thumbnail-btn');
    const thumbnailInput = document.getElementById('video-thumbnail');
    const thumbnailPreview = document.getElementById('thumbnail-preview');

    thumbnailBtn.addEventListener('click', () => {
      thumbnailInput.click();
    });

    thumbnailInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          thumbnailPreview.innerHTML = `<img src="${e.target.result}" alt="Thumbnail preview" />`;
        };
        reader.readAsDataURL(file);
      }
    });

    // Form validation
    function validateForm() {
      const hasVideo = videoPreview.style.display !== 'none';
      const hasTitle = titleInput.value.trim().length > 0;
      
      publishBtn.disabled = !(hasVideo && hasTitle);
    }

    // Form submission
    const videoForm = document.getElementById('video-details-form');
    videoForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      if (!publishBtn.disabled) {
        // Simulate upload process
        simulateUpload();
      }
    });

    function simulateUpload() {
      // Show upload progress
      uploadProgress.style.display = 'block';
      progressFill.style.width = '0%';
      progressText.textContent = '0%';
      
      let progress = 0;
      const interval = setInterval(() => {
        progress += Math.random() * 10;
        if (progress >= 100) {
          progress = 100;
          clearInterval(interval);
          
          // Upload complete
          setTimeout(() => {
            alert('Video uploaded successfully!');
            window.location.href = 'index.html';
          }, 500);
        }
        
        progressFill.style.width = progress + '%';
        progressText.textContent = Math.round(progress) + '%';
      }, 200);
    }

    // Save draft functionality
    const saveDraftBtn = document.getElementById('save-draft-btn');
    saveDraftBtn.addEventListener('click', function() {
      const videoData = {
        title: titleInput.value,
        description: descriptionInput.value,
        category: document.getElementById('video-category').value,
        tags: document.getElementById('video-tags').value,
        privacy: document.getElementById('video-privacy').value,
        timestamp: new Date().toISOString()
      };
      
      // Save to localStorage
      const drafts = JSON.parse(localStorage.getItem('videoDrafts') || '[]');
      drafts.push(videoData);
      localStorage.setItem('videoDrafts', JSON.stringify(drafts));
      
      alert('Draft saved successfully!');
    });

    // Search functionality
    const searchInput = document.querySelector('.search-input');
    const searchBtn = document.querySelector('.search-btn');

    // Add search icon to the left of search input
    const searchIcon = document.createElement('i');
    searchIcon.className = 'fas fa-search search-icon';
    searchInput.parentNode.insertBefore(searchIcon, searchInput);

    // Search functionality
    searchBtn.addEventListener('click', performSearch);
    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        performSearch();
      }
    });

    function performSearch() {
      const query = searchInput.value.trim();
      if (query) {
        alert(`Searching for: ${query}`);
        // Future implementation: Redirect to search results
        // window.location.href = `search.html?q=${encodeURIComponent(query)}`;
      } else {
        searchInput.focus();
      }
    }
  </script>
</body>
</html>